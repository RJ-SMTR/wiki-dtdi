{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"<i>Hello world</i> \ud83d\ude8f","text":"<p>Seja bem vinde \u00e0 wiki da Diretoria T\u00e9cnica de Dados e Inova\u00e7\u00e3o da SMTR (DTDI)!</p> <p>Aqui voc\u00ea encontra informa\u00e7\u00f5es sobre o nosso data lake, sistemas e aplica\u00e7\u00f5es, e infraestrutura desenvolvidos pelo time.</p> <p>Navegue nas se\u00e7\u00f5es do menu \u00e0 esquerda para encontrar:</p> <ul> <li> <p>Equipe: Pessoas que comp\u00f5e o time e fazem tudo acontecer</p> </li> <li> <p>Data lake: Cat\u00e1logo de dados, como explorar os dados e entender dados de transporte (ex: GTFS, GPS, bilhetagem, subs\u00eddio)</p> </li> <li> <p>Sistemas e aplica\u00e7\u00f5es: Sistemas e aplica\u00e7\u00f5es desenvolvidos para a gest\u00e3o interna (ex: SIGMOB) e acesso p\u00fablico (ex: app de mobilidade).</p> </li> <li> <p>Infraestrutura (DevOps): Arquitetura de cloud da SMTR, sistemas de automa\u00e7\u00e3o de fluxos (CI/CD) e monitoramento da infraestrutura.</p> </li> </ul> <p>Para conhecer os nossos reposit\u00f3rios de c\u00f3digo aberto, navegue rapidamente nas organiza\u00e7\u00f5es:</p> <ul> <li>Secretaria de Transportes do Rio de Janeiro, sistemas e aplica\u00e7\u00f5es da SMTR.</li> <li>Prefeitura do Rio de Janeiro, sistema compartilhado de gest\u00e3o de fluxos de captura e tratamento de dados (pipelines e queries-rj-smtr, em migra\u00e7\u00e3o para pipelines_rj_smtr).</li> </ul>"},{"location":"team/","title":"Equipe","text":""},{"location":"team/#gestao","title":"Gest\u00e3o","text":"<p>Fernanda Scovino Diretora Linkedin | Github </p> <p></p> <p>Rafael Pinheiro Gestor de Dados Linkedin | Github </p> <p></p> <p>Caio dos Santos Gestor de Infraestrutura (DevOps) Linkedin | Github </p> <p></p> <p>Marcos Bernardo Gestor de Sistemas Linkedin | Github </p>"},{"location":"team/#dados","title":"Dados","text":"<p>Rodrigo Cunha Engenheiro de Dados Linkedin | Github </p> <p></p> <p>Victor Rocha Engenheiro de Dados Linkedin | Github </p>"},{"location":"team/#infraestrutura-devops","title":"Infraestrutura (DevOps)","text":"<p>Boris Ara\u00fajo Engenheiro de Infraestrutura (DevOps) Linkedin | Github </p>"},{"location":"team/#sistemas","title":"Sistemas","text":"<p>William Leite Desenvolvedor Linkedin | Github </p> <p></p> <p>Alexandre Ruiz Desenvolvedor Linkedin | Github </p> <p></p> <p>Gabriel Fortes Desenvolvedor Linkedin | Github </p> <p></p> <p>Raphael Rivas Desenvolvedor Linkedin | Github </p>"},{"location":"archive/","title":"Infraestrutura da SMTR","text":""},{"location":"archive/#visao-geral","title":"Vis\u00e3o geral","text":"<p>A infraestrutura da SMTR \u00e9 constru\u00edda em cima do Google BigQuery. Os projetos est\u00e3o divididos em:</p> <ul> <li>dev: ambiente de teste;</li> <li>staging: tabelas de staging do Base dos Dados no BigQuery</li> <li>prod: tabelas finais para consumo de outras \u00e1reas e aplica\u00e7\u00f5es.</li> </ul> <p>Todo c\u00f3digo das pipelinas de captura e/ou atualiza\u00e7\u00e3o das tabelas em desenvolvimento e produ\u00e7\u00e3o est\u00e3o versionados no Github.</p> <p></p>"},{"location":"archive/#datalake","title":"Datalake","text":""},{"location":"archive/#visao-geral_1","title":"Vis\u00e3o geral","text":"<ul> <li>Dagster/Maestro: Orquestrador de pipelines de captura e atualiza\u00e7\u00e3o de dados.<ul> <li>Gerenciamento de queries (maestro-bq)</li> <li>Qualquer erro na pipeline \u00e9 avisado no Discord</li> </ul> </li> </ul>"},{"location":"archive/#pipelines","title":"Pipelines","text":"<ul> <li>Lista das pipelines implementadas</li> <li>Fluxo de dados (dag)</li> </ul>"},{"location":"archive/maestro-bq/","title":"maestro-bq","text":"<p>Sistema de controle, versionamento e documenta\u00e7\u00e3o de queries do BigQuery usando o Maestro como orquestrador.</p>"},{"location":"archive/maestro-bq/#atributos-disponiveis-para-queries","title":"Atributos dispon\u00edveis para queries","text":"<ul> <li><code>run_key</code>: a chave montada no Dagster para essa execu\u00e7\u00e3o</li> <li><code>run_timestamp</code>: estampa de tempo dessa execu\u00e7\u00e3o (exclusivo para cada execu\u00e7\u00e3o de pipeline)</li> <li><code>maestro_sha</code>: hash do commit mais recente na branch default do reposit\u00f3rio maestro</li> <li><code>maestro_bq_sha</code>: hash do commit mais recente na branch default do reposit\u00f3rio maestro-bq</li> <li><code>date_range_start</code>: in\u00edcio da janela de filtragem para backfill</li> <li>Coincide com o <code>backfill.start_timestamp</code> do YAML na cria\u00e7\u00e3o da tabela</li> <li>Coincide com o timestamp da \u00faltima execu\u00e7\u00e3o nas outras execu\u00e7\u00f5es</li> <li><code>date_range_end</code>: fim da janela de filtragem para backfill</li> <li>Coincide com o timestamp do sensor (\u00fanico para todas as RunRequests daquela execu\u00e7\u00e3o do sensor)</li> <li>Tudo que estiver dentro da chave <code>parameters</code> do YAML, sem o prefixo <code>parameters.*</code></li> <li>Exemplo: no YAML -&gt; <code>parameters.interval = 2</code>, na query -&gt; <code>{{ interval }}</code></li> </ul>"},{"location":"archive/maestro-bq/#exemplo-de-materialized-view","title":"Exemplo de materialized view","text":"<ul> <li>Arquivo de query em <code>maestro-bq/materialized_views/br_rj_riodejaneiro_brt_gps/materialized_registros_tratada.sql</code>:</li> </ul> <pre><code>WITH box AS (\n  SELECT\n    *\n  FROM `rj-smtr.br_rj_riodejaneiro_geo.limites_geograficos_caixa`\n)\nSELECT\n  *,\n  {{ run_key }} AS run_key,\n  {{ run_timestamp }} AS run_timestamp,\n  {{ maestro_sha }} AS maestro_sha,\n  {{ maestro_bq_sha }} AS maestro_bq_sha,\nFROM `rj-smtr.br_rj_riodejaneiro_brt_gps.registros` \nWHERE DATETIME_DIFF(timestamp_captura, timestamp_gps, MINUTE) &lt; {{ interval }}\nAND timestamp_gps &gt;= {{ date_range_start }}\nAND timestamp_gps &lt; {{ date_range_end }}\nAND longitude BETWEEN (SELECT min_longitude FROM box) AND (SELECT max_longitude FROM box)\nAND latitude BETWEEN (SELECT min_latitude FROM box) AND (SELECT max_latitude FROM box)\n</code></pre> <ul> <li>Arquivo de configura\u00e7\u00e3o em <code>maestro-bq/materialized_views/br_rj_riodejaneiro_brt_gps/materialized_registros_tratada.yaml</code>:</li> </ul> <pre><code># Defini\u00e7\u00e3o de taxa de atualiza\u00e7\u00e3o\nscheduling:\n  cron: \"0/5 * * * *\"\n\n# Defini\u00e7\u00e3o de particionamento\n# - column: nome da coluna\n# - type: deve ser um dos seguintes\n#   * DATE (n\u00e3o exige per\u00edodo)\n#   * DATE_TRUNC (exige per\u00edodo MONTH/YEAR)\n#   * DATETIME_TRUNC (exige per\u00edodo DAY/HOUR/MONTH/YEAR)\n#   * TIMESTAMP_TRUNC (exige per\u00edodo DAY/HOUR/MONTH/YEAR)\n#   * &lt;To-do&gt; RANGE_BUCKET\n#   * &lt;To-do&gt; GENERATE_ARRAY\n# - period: per\u00edodo (conforme especificado acima)\npartitioning:\n  column: \"timestamp_gps\"\n  type: \"DATE\"\n  period: \"\"\n\n# Par\u00e2metros da query\nparameters:\n  interval: 2\n\n# Par\u00e2metros de backfill\nbackfill:\n  # Formato %Y-%m-%d %H:%M:%S\n  start_timestamp: \"2021-01-01 00:00:00\"\n</code></pre> <ul> <li>Resultado: cria\u00e7\u00e3o da tabela <code>br_rj_riodejaneiro_brt_gps.materialized_registros_tratada</code> que se materializa incrementalmente a cada 5 minutos e particionada diariamente em <code>timestamp_gps</code></li> </ul>"},{"location":"archive/maestro/","title":"Maestro","text":"<p>Maestro \u00e9 o nome dado a nosso orquestrador de pipelines de captura e atualiza\u00e7\u00e3o de dados. </p> <p>O Maestro \u00e9 constru\u00eddo com o software Dagster e \u00e9 executado em ambiente Docker.</p>"},{"location":"archive/maestro/#instalacao","title":"Instala\u00e7\u00e3o","text":""},{"location":"archive/maestro/#requisitos","title":"Requisitos","text":"<ul> <li>Docker</li> <li>Python &gt;= 3.8 (outras vers\u00f5es n\u00e3o s\u00e3o testadas)</li> </ul>"},{"location":"archive/maestro/#pre-configuracao","title":"Pr\u00e9-configura\u00e7\u00e3o","text":"<ol> <li>Clone o reposit\u00f3rio oficial do Maestro: <pre><code>git clone https://github.com/RJ-SMTR/maestro &amp;&amp; cd maestro/\n</code></pre></li> <li>Crie um ambiente virtual e instale o maestro: <pre><code># cria ambiente\npython -m venv .maestro\n# ativa ambiente\n. .maestro/bin/activate\n# instala maestro\npip3 install -e .\n</code></pre></li> <li> <p>Prepare um arquivo com vari\u00e1veis de ambiente chamado <code>.env_local</code>. Ele deve seguir o seguinte modelo (preencher somente onde \u00e9 requisitado): <pre><code>MODE=dev\nDAGSTER_POSTGRES_USER=postgres\nDAGSTER_POSTGRES_PASSWORD=123456\nDAGSTER_POSTGRES_HOST=localhost\nDAGSTER_POSTGRES_DB=postgres\nREDIS_HOST=localhost\nBQ_PROJECT_NAME=rj-smtr-dev\nSENSOR_BUCKET=rj-smtr-dev\nBASEDOSDADOS_CONFIG=&lt;preencher&gt;\nBASEDOSDADOS_CREDENTIALS_PROD=&lt;preencher&gt;\nBASEDOSDADOS_CREDENTIALS_STAGING=&lt;preencher&gt;\nDAGSTER_HOME=&lt;preencher&gt;\n</code></pre></p> </li> <li> <p>Preencha <code>DAGSTER_HOME</code> com o caminho do reposit\u00f3rio do maestro + <code>.dagster_workspace</code>. Exemplo: <code>/home/user/git_repos/maestro/.dagster_workspace</code></p> </li> <li> <p>Preencha <code>BASEDOSDADOS_CONFIG</code> com o resultado de <code>cat $HOME/.basedosdados/config.toml | base64</code>, considerando que voc\u00ea possui as credenciais de DEV</p> </li> <li> <p>Preencha <code>BASEDOSDADOS_CREDENTIALS_PROD</code> e <code>BASEDOSDADOS_CREDENTIALS_STAGING</code> com o resultado de <code>cat .basedosdados/credentials/prod.json | base64</code>, considerando que voc\u00ea possui as credenciais de DEV</p> </li> </ol>"},{"location":"archive/maestro/#ligando-os-servicos","title":"Ligando os servi\u00e7os","text":""},{"location":"archive/maestro/#configurando-o-docker","title":"Configurando o Docker","text":"<p>Caso esteja rodando pela primeira vez ou tenha adicionado uma nova depend\u00eancia, execute a configura\u00e7\u00e3o do Dagster com:</p> <pre><code># ativando o ambiente (se n\u00e3o estiver ativo)\n. .maestro/bin/activate\n# configurando o maestro\nmaestro setup\n</code></pre> <p>Este comando instala as depend\u00eancias, configura o container (Docker) no qual o Dagster ficar\u00e1 ativo e indica qual host deve ser usado (neste caso, o localhost).</p>"},{"location":"archive/maestro/#ativando-o-maestro","title":"Ativando o Maestro","text":"<p>Para ativar o Maestro, execute o comando:</p> <pre><code># ativando o ambiente (se n\u00e3o estiver ativo)\n. .maestro/bin/activate\n# rodando o maestro\nmaestro up\n</code></pre> <p>Com isso, o Dagit ficar\u00e1 dispon\u00edvel em http://localhost:3000/. Os logs do daemon, dagit e gRPC ser\u00e3o todos redirecionados ao mesmo terminal.</p>"},{"location":"archive/maestro/#desativando","title":"Desativando","text":"<p>Para desativar o Maestro, basta fechar seu terminal (Ctrl+C).</p> <p>Caso queira remover as imagens criadas no Docker (por espa\u00e7o ou necessidade de uso das respectivas portas), rode:</p> <pre><code># removendo imagens Docker do maestro\nmaestro down\n</code></pre> <p>Aten\u00e7\u00e3o!</p> <p>Uma vez removidas as imagens, \u00e9 necess\u00e1rio configurar novamente o Docker antes ativar o Dagster, rodando: <pre><code>maestro setup\nmaestro up\n</code></pre></p>"},{"location":"archive/multas-automaticas/","title":"Multas Autom\u00e1ticas - Metodologia","text":"<p>Vers\u00e3o: v1.0</p> <p>Data de in\u00edcio: 19/10/21</p>"},{"location":"archive/multas-automaticas/#visao-geral","title":"Vis\u00e3o geral","text":"<p>O C\u00f3digo Disciplinar do Servi\u00e7o P\u00fablico de Transporte de Passageiros por meio de \u00d4nibus do Munic\u00edpio do Rio de Janeiro (C\u00f3digo de Conduta do SPPO), institu\u00edda via decreto n\u00ba 36343), determina uma s\u00e9rie de condi\u00e7\u00f5es para a opera\u00e7\u00e3o, gest\u00e3o e qualidade das linhas municipais. Essas condi\u00e7\u00f5es, quando n\u00e3o cumprias, resultam em poss\u00edveis multas e outras san\u00e7\u00f5es.</p> <p>A partir de 2021, a SMTR passa a realizar o c\u00e1lculo de multas autom\u00e1ticas a partir da ferramenta desenvolvida de monitoramento por GPS, conforme resolu\u00e7\u00e3o n\u00ba 3413.</p> <p>As multas aplicadas atrav\u00e9s da ferramenta podem ser aplicadas em 3 casos:</p> <ul> <li>Frota operante abaixo da determinada</li> <li>Falha no GPS (n\u00e3o implementado)</li> <li>N\u00e3o opera\u00e7\u00e3o da linha (n\u00e3o implementado)</li> </ul> <p>Para a vers\u00e3o 1.0 da ferramenta, consideramos somente infra\u00e7\u00f5es de frota operante abaixo da determinada em hor\u00e1rios de pico como pass\u00edveis de multa, com exce\u00e7\u00e3o de s\u00e1bados e domingos.</p>"},{"location":"archive/multas-automaticas/#definicoes","title":"Definic\u00f5es","text":"<ul> <li>Cons\u00f3rcio: Empresa respons\u00e1vel pela opera\u00e7\u00e3o dos itiner\u00e1rios das linhas. Usualmente, cons\u00f3rcios operam linhas com exclusividade.</li> <li>Linha: Conjunto de servi\u00e7os, usualmente descrito por n\u00fameros, ex: 123, 720.</li> <li>Servi\u00e7o: Conjunto de itiner\u00e1rios, usualmente descrito pela linha e   identificador do servi\u00e7o, ex: 123 RA, 720 PR. As linhas podem ter   servi\u00e7os normais e espec\u00edficos (como 'Parador', 'Expresso', 'Noturno',   etc).</li> <li>Itiner\u00e1rio: Trajetos executados por ve\u00edculos que param em pontos espec\u00edficos e tem frequ\u00eancia de sa\u00edda ou frota determinada.</li> <li>Frota determinada: N\u00famero de ve\u00edculos que dever\u00e3o operar em uma linha, definido pela SMTR.</li> <li>Frota operante: N\u00famero de ve\u00edculos distintos em operac\u00e3o que   emitem um sinal de gps em determinada faixa hor\u00e1ria. Os ve\u00edculos   considerados em operac\u00e3o s\u00e3o aqueles que (Art. 2 I da Resolu\u00e7\u00e3o):<ul> <li>n\u00e3o est\u00e3o em garagens (veja a lista de garagens consideradas);</li> <li>[N\u00c3O IMPLEMENTADO] tem o servi\u00e7o do gps associado ao mesmo trajeto que est\u00e1 sendo realizado no instante da emiss\u00e3o do sinal (ver documenta\u00e7\u00e3o da pipeline de gps);</li> <li>[N\u00c3O IMPLEMENTADO] n\u00e3o tiveram velocidade menor que 3km/h por mais que 10 minutos consecutivos.</li> </ul> </li> <li>Faixa hor\u00e1ria: intervalo de 10 minutos comecando no primeiro   minuto da hora, ex: 6:00, 6:10, 6:20. A faixa hor\u00e1ria ser\u00e1   desconsiderada caso ocorra mais que 2 falhas na captura dos dados de   GPS pela SMTR. A captura \u00e9 executada a cada 1 minuto, portanto,   espera-se 8 capturas a cada faixa hor\u00e1ria.</li> <li>Gravidade da multa (Art. 44): As multas para atos oriundos   diretamente do permission\u00e1rio/concession\u00e1rio classificam-se em quatro   categorias, de acordo com sua gravidade (Tabela 1)</li> </ul>"},{"location":"archive/multas-automaticas/#tipos-de-multa","title":"Tipos de multa","text":""},{"location":"archive/multas-automaticas/#frota-operante-abaixo-da-frota-determinada","title":"Frota operante abaixo da frota determinada","text":"<p>O C\u00f3digo de Conduta do SPPO disp\u00f5e no Artigo 17.I sobre as condi\u00e7\u00f5es para aplicac\u00e3o de multas aos cons\u00f3ricios que operarem linhas abaixo da frota determinada.</p>"},{"location":"archive/multas-automaticas/#definicao","title":"Defini\u00e7\u00e3o","text":"<p>Segundo o C\u00f3digo de Conduta do SPPO no Artigo 17.I, as condic\u00f5es para aplicac\u00e3o da multa por frota operante abaixo da frota determinada s\u00e3o as seguintes:</p> <ul> <li>Se frota determinada &lt;= 5, ent\u00e3o o cons\u00f3rcio estar\u00e1 sujeito a multa sempre que a frota operante for menor que a frota determina.</li> <li>Se frota determinada &gt; 5, ent\u00e3o o cons\u00f3rcio estar\u00e1 sujeito a multa sempre que a frota operante for:<ul> <li>&lt; 80% da frota determinada, para dias \u00fateis</li> <li>[N\u00c3O CONSIDERADO] &lt; 50% da frota determinada, para s\u00e1bados</li> <li>[N\u00c3O CONSIDERADO] &lt; 40% da frota determinada, para domingos e feriados</li> </ul> </li> </ul>"},{"location":"archive/multas-automaticas/#regras-especificas-para-aplicacao","title":"Regras espec\u00edficas para aplica\u00e7\u00e3o","text":"<p>O C\u00f3digo de Conduta do SPPO n\u00e3o explicita como operacionalizar a aplicac\u00e3o das multas via gps. Portanto, a SMTR define junto \u00e0 Resolu\u00e7\u00e3o, um conjunto de regras quais s\u00e3o:</p> <ul> <li>Ser\u00e1 aplicada somente uma multa por pico da manh\u00e3 e da tarde (Art.   2 II). Ou    seja, cada linha est\u00e1 sujeita a no m\u00e1ximo 2 multas por dia. Os    hor\u00e1rios que determinam o pico s\u00e3o diferentes para cada cons\u00f3rcio    dado a natureza de suas opera\u00e7\u00f5es (ver Tabela 1)</li> <li> <p>A frota operante ser\u00e1 calculada para cada linha e faixa hor\u00e1ria.   Se as condi\u00e7\u00f5es satisfizerem a defini\u00e7\u00e3o acima, ent\u00e3o a   linha naquela faixa hor\u00e1ria ser\u00e1 considerada abaixo da frota   determinada.</p> </li> <li> <p>As multas ser\u00e3o aplicadas para um pico se:</p> <ul> <li>existirem 3 faixas hor\u00e1rias (30 minutos) consecutivas abaixo da frota determinada</li> <li>existirem 8 faixas hor\u00e1rias (80 minutos) n\u00e3o consecutivas abaixo da frota determinada</li> </ul> </li> </ul>"},{"location":"archive/multas-automaticas/#falha-no-gps-nao-implementado","title":"Falha no GPS (n\u00e3o implementado)","text":"<p>Segundo o Art. 17 X do C\u00f3digo de Conduta do SPPO, as condic\u00f5es para aplicac\u00e3o da multa por falha de GPS s\u00e3o as seguintes:</p> <pre><code>IX \u2013 Suspender por 24 (vinte e quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o do sistema de\ncontrole da linha atrav\u00e9s de GPS:\nInfra\u00e7\u00e3o \u2013 grav\u00edssima\nPenalidade \u2013 multa (Grupo E-1)\n\nX \u2013 Suspender por 1 (uma) hora ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o do sistema de controle da linha\natrav\u00e9s de GPS:\nInfra\u00e7\u00e3o \u2013 grave\nPenalidade \u2013 multa (Grupo E-2)\n</code></pre>"},{"location":"archive/multas-automaticas/#nao-operacao-da-linha-nao-implementado","title":"N\u00e3o opera\u00e7\u00e3o da linha (n\u00e3o implementado)","text":"<p>Segundo o Art. 17 X do C\u00f3digo de Conduta do SPPO, as condic\u00f5es para aplicac\u00e3o da multa por falha de GPS s\u00e3o as seguintes:</p> <pre><code>VII \u2013 Suspender por 24 (vinte e quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de Transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o de uma linha ou\nservi\u00e7o, em um ou ambos os sentidos:\nInfra\u00e7\u00e3o \u2013 grav\u00edssima\nPenalidade \u2013 multa (Grupo E-1)\n\nVIII \u2013 Suspender por 4 (quatro) horas ou mais, sem autoriza\u00e7\u00e3o pr\u00e9via do \u00d3rg\u00e3o Gestor de Transportes do Munic\u00edpio do Rio de Janeiro, a opera\u00e7\u00e3o de uma linha ou servi\u00e7o,\nem um ou ambos os sentidos:\nInfra\u00e7\u00e3o \u2013 grav\u00edssima\nPenalidade \u2013 multa (Grupo E-1)\n</code></pre>"},{"location":"archive/multas-automaticas/#estrutura-dos-dados","title":"Estrutura dos dados","text":"<p>Para verifica\u00e7\u00e3o das multas s\u00e3o geradas 3 tabelas principais:</p> <ul> <li>Sum\u00e1rio de multas por linha (<code>sumario_multa_linha_onibus</code>)</li> <li>Detalhes de multa por linha (<code>detalhes_multa_linha_onibus</code>)</li> <li>Detalhes de multa por ve\u00edculos (<code>detalhes_multa_veiculo_onibus</code>)</li> </ul> <p>A documenta\u00e7\u00e3o completa da pipeline de captura, tratamento e atualiza\u00e7\u00e3o dos dados pode ser lida aqui.</p>"},{"location":"archive/multas-automaticas/#tabelas-e-figuras-de-referencia","title":"Tabelas e figuras de refer\u00eancia","text":"<p>Tabela 1: Gravidade da multa</p> Grupo Gravidade Valor Grupo E-1 Grav\u00edssima 520 (quinhentas e vinte) UFIR-RJ Grupo E-2 Grave 260 (duzentas e sessenta) UFIR-RJ Grupo E-3 M\u00e9dia 130 (cento e trinta) UFIR-RJ Grupo E-4 Leve 65 (sessenta e cinco) UFIR-RJ <p>Tabela 2: Picos por cons\u00f3rcio (ajustado hor\u00e1rio de pico da manh\u00e3)</p> Cons\u00f3rcio Pico Manh\u00e3 Pico Tarde Intersul 6:30 - 9:30 16:00 - 19:00 Internorte 6:00 - 9:00 16:00 - 19:00 Transcarioca 6:00 - 9:00 16:00 - 19:00 Santa Cruz 5:30 - 8:30 17:00 - 20:00"},{"location":"dados/","title":"Data lake","text":"<p>O data lake da SMTR cont\u00e9m os dados de opera\u00e7\u00e3o, planejamento e monitoramento do sistema de transporte municipal da cidade. Esses dados s\u00e3o fonte para a execu\u00e7\u00e3o de diferentes pol\u00edticas p\u00fablicas da secretaria, como o Subs\u00eddio dos \u00f4nibus e a C\u00e2mara de Compensa\u00e7\u00e3o Tarif\u00e1ria (CCT)</p>"},{"location":"dados/#catalogo-de-dados","title":"Cat\u00e1logo de dados","text":"<p>Abaixo voc\u00ea encontra a lista de todas as bases que constam atualmente no nosso data lake.</p>"},{"location":"dados/#como-acessar-o-data-lake","title":"Como acessar o data lake","text":""},{"location":"dados/#conheca-os-dados-de-transporte-publico-da-cidade","title":"Conhe\u00e7a os dados de transporte p\u00fablico da cidade","text":""},{"location":"devops/","title":"Infraestrutura (DevOps)","text":""},{"location":"devops/#o-que-e-devops","title":"O que \u00e9 DevOps?","text":"<p>O termo DevOps \u00e9 a contra\u00e7\u00e3o e jun\u00e7\u00e3o dos termos development (dev) e operations (ops). \u00c9 um conjunto de pr\u00e1ticas que visa reduzir o ciclo de entregas das equipes de desenvolvimento por meio de automa\u00e7\u00f5es de  tarefas recorrentes (como compila\u00e7\u00e3o e deploy) e padroniza\u00e7\u00e3o de ambientes .</p> <p>Na SMTR, a equipe de DevOps \u00e9 respons\u00e1vel pela configura\u00e7\u00e3o dos cont\u00eaineres onde rodam as aplica\u00e7\u00f5es, da infraestrutura de Cloud, pelos processos entrega e integra\u00e7\u00e3o cont\u00ednua (CI/CD) e observabilidade. </p>"},{"location":"devops/#infraestrutura-de-cloud-da-smtr","title":"Infraestrutura de Cloud da SMTR","text":"<p>A infraestrutura de Cloud da SMTR est\u00e1 hospedada na Google Cloud Platform (GCP), e pode ser acessada por meio deste link: https://console.cloud.google.com/</p>"},{"location":"devops/#clusters","title":"Clusters","text":"<p>O ambiente de produ\u00e7\u00e3o rj-smtr possui tr\u00eas clusters:</p> <ul> <li>rj-smtr-dev: ambiente de desenvolvimento</li> <li>rj-smtr-gke: ambiente de produ\u00e7\u00e3o onde s\u00e3o executadas as pipelines de dados</li> <li>rj-smtr: ambiente de produ\u00e7\u00e3o onde s\u00e3o executadas as demais aplica\u00e7\u00f5es</li> </ul>"},{"location":"devops/#rj-smtr-dev","title":"rj-smtr-dev","text":"<p>O ambiente de desenvolvimento \u00e9 completamente separado dos ambientes de produ\u00e7\u00e3o. Desta forma, evita-se tanto conflito de depend\u00eancias, quanto disputa por recursos.</p>"},{"location":"devops/#rj-smtr-gke","title":"rj-smtr-gke","text":"<p>Existem dois pods neste cluster:</p> <ul> <li>prefect</li> <li>redis</li> </ul>"},{"location":"devops/#prefect","title":"prefect","text":"<p>O pod prefect \u00e9 pod que executa as pipelines de dados, por exemplo:</p> <ul> <li>captura de dados minuto a minuto;</li> <li>captura de dados hora em hora;</li> <li>materializa\u00e7\u00e3o de tabela;</li> <li>consolida\u00e7\u00e3o de dados di\u00e1ria.</li> </ul> <p>As pipelines s\u00e3o controladas por meio do Prefect, seu c\u00f3digo pode ser encontrado neste reposit\u00f3rio e sua documenta\u00e7\u00e3o neste link.</p>"},{"location":"devops/#redis","title":"redis","text":"<p>Paralelamente ao Prefect que executa as pipelines, \u00e9 executado o banco de dados em mem\u00f3ria redis. Se faz necess\u00e1rio usar tal tecnologia para cache. A quantidade de dados adquirida momento-a-momento pela pipeline \u00e9 muito grande. Escrever os dados na GCP em tempo real eleva muito os custos. Ent\u00e3o, faz-se o cache no redis e escreve-se os dados de minuto em minuto, hora em hora, e at\u00e9 em consolida\u00e7\u00f5es di\u00e1rias.</p>"},{"location":"devops/#rj-smtr","title":"rj-smtr","text":"<p>Neste cluster existem duas aplica\u00e7\u00f5es com seus respectivos front-ends e back-ends, e ambientes de staging e produ\u00e7\u00e3o.</p>"},{"location":"devops/#mobilidade-rio-api-staging-e-producao","title":"mobilidade-rio-api (staging e produ\u00e7\u00e3o)","text":"<p>\u00c9 o pod que cont\u00e9m a API respons\u00e1vel pelo back-end do app https://mobilidade.rio/</p> <p>A API \u00e9 escrita em Django e seu reposit\u00f3rio pode ser acessado aqui.</p> <p>O ambiente de staging est\u00e1 contido no namespace mobilidade-v2-staging e pode ser acessado em https://api.staging.mobilidade.rio/</p> <p>O ambiente de produ\u00e7\u00e3o est\u00e1 contido no namespace mobilidade-v2 e pode ser acessado em https://api.mobilidade.rio/</p>"},{"location":"devops/#mobilidade-rio-app-staging-e-producao","title":"mobilidade-rio-app (staging e produ\u00e7\u00e3o)","text":"<p>\u00c9 o pod que cont\u00e9m o front-end do app https://mobilidade.rio/</p> <p>A interface de usu\u00e1rio \u00e9 escrita em React e seu reposit\u00f3rio pode ser acessado aqui.</p> <p>O ambiente de staging tamb\u00e9m est\u00e1 contido no namespace mobilidade-v2-staging e pode ser acessado em https://app.staging.mobilidade.rio/</p> <p>O ambiente de produ\u00e7\u00e3o tamb\u00e9m est\u00e1 contido no namespace mobilidade-v2 e pode ser acessado em https://mobilidade.rio/</p>"},{"location":"devops/#data-tools-api-e-data-tools-ui-staging-e-producao","title":"data-tools-api e data-tools-ui (staging e produ\u00e7\u00e3o)","text":"<p>Tanto o back-end quanto o front-end utilizam a ferramenta IBI Transit Data Tools, sua documenta\u00e7\u00e3o pode ser encontrada aqui.</p> <p>Os reposit\u00f3rios est\u00e3o acess\u00edveis em:</p> <ul> <li>https://github.com/RJ-SMTR/sigmob-api (API)</li> <li>https://github.com/RJ-SMTR/sigmob-app (interface de usu\u00e1rio)</li> </ul> <p>O ambiente de staging utiliza o namespace gtfs-editor-staging e \u00e9 acess\u00edvel em https://gtfs-editor.staging.mobilidade.rio/</p> <p>O ambiente de produ\u00e7\u00e3o utiliza o namespace gtfs-editor e \u00e9 acess\u00edvel em https://gtfs-editor.mobilidade.rio/</p>"},{"location":"devops/#cicd","title":"CI/CD","text":""},{"location":"devops/#versionamento","title":"Versionamento","text":"<p>Todos os projetos s\u00e3o versionados com a ferramenta Git, hospedados no Github e podem ser encontrados nos seguintes perfis:</p> <ul> <li>Secretaria de Transportes do Rio de Janeiro</li> <li>Prefeitura do Rio de Janeiro</li> </ul>"},{"location":"devops/#deploy","title":"Deploy","text":"<p>Os processos de deploy s\u00e3o feitos por meio da ferramenta Github Actions. No Github Actions, o deploy \u00e9 acionado por meio de um gatilho. Sempre que um commit \u00e9 feito em uma branch que possua um processo de deploy configurado, um script de workflow \u00e9 executado.</p> <p>O script de workflow configura e executa diversas tarefas, como, por exemplo:</p> <ul> <li>defini\u00e7\u00e3o de vari\u00e1veis de ambiente;</li> <li>compila\u00e7\u00e3o de cont\u00eaineres e upload das imagens para a nuvem;</li> <li>instala\u00e7\u00e3o de depend\u00eancias e certificados;</li> <li>execu\u00e7\u00e3o de testes unit\u00e1rios;</li> <li>execu\u00e7\u00e3o de scripts necess\u00e1rios para inicializa\u00e7\u00e3o;</li> <li>compila\u00e7\u00e3o e execu\u00e7\u00e3o da aplica\u00e7\u00e3o;</li> <li>demais etapas de configura\u00e7\u00e3o que se fizerem necess\u00e1rias.</li> </ul> <p>Ao fim, se todas as etapas ocorreram sem nenhum problema, a nova vers\u00e3o entra em execu\u00e7\u00e3o.</p> <p>A documenta\u00e7\u00e3o do Github Actions pode ser encontrada neste link.</p>"},{"location":"devops/#observabilidade","title":"Observabilidade","text":"<p>No momento, o projeto observabilidade est\u00e1 sendo desenvolvido. Por enquanto, h\u00e1 duas ferramentas em funcionamento para observabilidade.</p> <ul> <li>Monitor de uptime de diversos servi\u00e7os que s\u00e3o executados na nuvem: https://uptime.mobilidade.rio/status/monitor</li> <li>Alertas de uptime: a todo o momento as aplica\u00e7\u00f5es s\u00e3o testadas com webhooks, conforme seu comportamento muda, alertas s\u00e3o emitidos no canal do Discord da SMTR.</li> </ul>"}]}